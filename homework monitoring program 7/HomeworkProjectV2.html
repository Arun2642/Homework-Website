<html>
<body>
<input type="file" id="files" name="files[]"/>
<button onclick="updateGraph()">Update Graph</button>
<button onclick="pieGraph()">Make Pie</button>
<form>
  First name:<br>
  <input type="text" name="StudentID" id="doesThisWork"><br>
</form> 
    
<output id="list"></output>
<div id="summaryData"></div>
<div id="normalizedTable"></div>
<div id="table"></div>

<p> Hello, and welcome to the test for the homework monitoring project! <\p>
    
<div id="tester" style="width:600px;height:250px;"></div>
    
<div id="pie" style="width:600px;height:250px;"></div>
    
<div id="week" style="width:2400px;height:1000px;"></div>

<div id="classTimeSeries" style="width:2400px;height:1000px;"></div>

<div id="percentTimeSeries" style="width:2400px;height:1000px;"></div>


<script type="text/javascript" src="scripts/fileProcessing.js"></script>
<script type="text/javascript" src="scripts/homeworkParse.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    
<script>
    
/* function generateClassTimeData(idInput){
    dataArray = []
    startTime = studentList[idInput].assignmentArray[0].startTime - studentList[idInput].assignmentArray[0].startTime % 1440
    for (i=0;i<studentList[idInput].courseList.length;i++){
        classData = []
        for (a=0;a<Math.floor((studentList[idInput].assignmentArray[studentList[idInput].assignmentArray.length-1].startTime - startTime)/1440);i++){
            classData[a] = 0
        }
        console.log("Hello, resetting")
        console.log(classData)
        daysSinceStart = 0
        for (j=0;j<studentList[idInput].assignmentArray.length;j++){
            if(studentList[idInput].assignmentArray[j].course){
                if (studentList[idInput].assignmentArray[j].course.courseID==studentList[idInput].courseList[i].courseID){
                    if (studentList[idInput].assignmentArray[j].startTime > startTime + 1440*(daysSinceStart+1)){
                        daysSinceStart = Math.floor((studentList[idInput].assignmentArray[j].startTime - startTime)/1440)
                    }
                    if(classData[classData.length]){
                        classData[classData.length] = classData[classData.length-1]
                    }
                    else{classData[classData.length] = classData[classData.length-1]}
                    
                classData[daysSinceStart] = classData[daysSinceStart] + studentList[idInput].assignmentArray[j].assignmentDuration
                }
            }
        }
        dataArray[i] = classData
    }
    return dataArray
} */

function generateClassTimeSeries(idInput, courseOfInterest){
    classData = []
    startTime = studentList[idInput].assignmentArray[0].startTime - studentList[idInput].assignmentArray[0].startTime % 1440
    //console.log(startTime)
    loopNumber = Math.floor((studentList[idInput].assignmentArray[studentList[idInput].assignmentArray.length-1].startTime - startTime)/1440)
    for (var i=0; i<loopNumber; i++){
        classData[i] = 0
    }
    //console.log(classData.length)
    for (var i=0; i<studentList[idInput].assignmentArray.length;i++){
        if (studentList[idInput].assignmentArray[i].course == null){
            //console.log("MEEP")
            continue;
        }
        //console.log(studentList[idInput].assignmentArray[i].course.courseCode)
        //console.log(courseOfInterest)
        if (studentList[idInput].assignmentArray[i].course.courseCode == courseOfInterest){
            //console.log("true")
            for (var j=Math.floor((studentList[idInput].assignmentArray[i].startTime - startTime)/1440); j<classData.length; j++){
                classData[j] += studentList[idInput].assignmentArray[i].assignmentDuration
            }
        }
    }
    return classData
}

function generateLineData(idInput){
    var courseList = studentList[idInput].courseList
    //console.log(courseList)
    var dataArray = []
    var loopNumber = courseList.length
    //console.log(loopNumber)
    for (var k=0;k<loopNumber;k++){
        //console.log("Looping" + k)
        dataArray[k] = generateClassTimeSeries(idInput,courseList[k].courseCode)
    }
    var courseNames = []
    for (var n=0;n<courseList.length;n++){
        courseNames[n] = courseList[n].courseCode
    }
    var dayNumbers = []
    for (var m=0;m<dataArray[0].length;m++){
        dayNumbers[m] = m
    }
    return [dataArray,courseNames,dayNumbers]
}

function generatePercentLineData(idInput){
    var courseList = studentList[idInput].courseList
    //console.log(courseList)
    var prelimDataArray = []
    var loopNumber = courseList.length
    var dataArray = []
    //console.log(loopNumber)
    for (var k=0;k<loopNumber;k++){
        //console.log("Looping" + k)
        prelimDataArray[k] = generateClassTimeSeries(idInput,courseList[k].courseCode)
        dataArray[k] = []
    }
    for (var k=0;k<loopNumber;k++){
        for (var i=0;i<prelimDataArray[0].length;i++){
            var timeSum = 0
            for (var n=0;n<loopNumber;n++){
                timeSum += prelimDataArray[k][n]
            }
            console.log(prelimDataArray[k][i]/timeSum)
            dataArray[k][i] = (prelimDataArray[k][i]/timeSum)
        }
    }
    var courseNames = []
    for (var n=0;n<courseList.length;n++){
        courseNames[n] = courseList[n].courseCode
    }
    var dayNumbers = []
    for (var m=0;m<dataArray[0].length;m++){
        dayNumbers[m] = m
    }
    return [dataArray,courseNames,dayNumbers]
}

function dayFromTime(time){
weekResidue = time % 10080
daysSinceSunday = Math.floor(weekResidue/1440)
return daysSinceSunday

}

function generateWeekData(idInput){
    weekProfile = [0,0,0,0,0,0,0]
    for (i=0;i<studentList[idInput].assignmentArray.length;i++){
        console.log("loopy")
        weekProfile[dayFromTime(studentList[idInput].assignmentArray[i].startTime)] = weekProfile[dayFromTime(studentList[idInput].assignmentArray[i].startTime)] + studentList[idInput].assignmentArray[i].assignmentDuration
    }
    return weekProfile
}    
    
function updateGraph(){
idInput = parseInt(document.getElementById("doesThisWork").value)
classNames = []
for (i=0;i<courseList.length;i++){
    classNames.push(courseList[i].courseCode)
}
avgClassTimes = []
for (i=0;i<courseList.length;i++){
    avgClassTimes.push(courseList[i].avgTotalTime)
}
studentClasses = [];
for (i=0;i<studentList[idInput].courseList.length;i++){
    studentClasses.push(studentList[idInput].courseList[i].courseCode)
}
studentClassTimes = [];
for (i=0;i<studentList[idInput].courseList.length;i++){
    console.log("hi")
    studentClassTimes.push(studentList[idInput].courseList[i].totalTime)
}
weekTimes = generateWeekData(idInput);
classTimeSeriesData = []
//percentTimeSeriesData = []
for (var i=0; i<studentList[idInput].courseList.length;i++){
            classTimeSeriesData[i] = {y:generateLineData(idInput)[0][i],x:generateLineData(idInput)[2],name:generateLineData(idInput)[1], mode: 'lines', type: 'scatter'}
            //percentTimeSeriesData[i] = {y:generatePercentLineData(idInput)[0][i],x:generatePercentLineData(idInput)[2],name:generatePercentLineData(idInput)[1], mode: 'lines', type: 'scatter'}
}
    
trace1 = {
  x: avgClassTimes, 
  y: classNames, 
  marker: {
    color: 'rgba(55, 128, 191, 0.6)', 
    line: {
      color: 'rgba(55, 128, 191, 1.0)', 
      width: 1
    }
  }, 
  name: 'SF Zoo', 
  orientation: 'h', 
  type: 'bar'
};

data = [trace1];
layout = {barmode: 'stack'};
Plotly.plot('tester', {
  data: data,
  layout: layout
});
}

    
function pieGraph(){
    var data_pie = [{
        values: studentClassTimes,
        labels: studentClasses,
        type: 'pie'
      }];

    var layout = {
        height: 400,
        width: 500
    };
      
    Plotly.newPlot('pie', data_pie);
    
    var data_week = [{
        y: weekTimes,
        x: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
        type: 'bar',
        orientation: 'v'
      }];
    
    Plotly.newPlot('week', data_week);
    Plotly.newPlot('classTimeSeries', classTimeSeriesData);
    //Plotly.newPlot('percentTimeSeries', percentTimeSeriesData);

        


/* Plotly.plot('pie', {
  data: data_pie,
  layout: layout_pie
}); */

}
</script>

</body>
</html>
